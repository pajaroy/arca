AquÃ­ estÃ¡ la implementaciÃ³n completa y corregida del validador utilizandoÂ `pathlib`:

python

Copy

Download

# core/validador.py
import json
from pathlib import Path
from json.decoder import JSONDecodeError
import jsonschema
from jsonschema import ValidationError
from jsonschema.validators import Draft7Validator

def validar_esquema(data: dict, nombre_esquema: str) -> None:
    """
    Valida un diccionario contra un esquema JSON Schema Draft 7.
    
    Args:
        data: Diccionario con los datos a validar
        nombre_esquema: Nombre del archivo en la carpeta schemas (ej: 'schema_base.json')
    
    Raises:
        FileNotFoundError: Si el archivo de esquema no existe
        JSONDecodeError: Si el esquema no es JSON vÃ¡lido
        ValidationError: Si la validaciÃ³n falla
    """
    # Construir ruta absoluta al esquema
    base_path = Path(__file__).parent.parent
    schemas_dir = base_path / "schemas"
    schema_path = schemas_dir / nombre_esquema

    # Verificar existencia del archivo
    if not schema_path.exists():
        raise FileNotFoundError(f"Esquema no encontrado: {schema_path}")

    # Cargar y validar esquema
    try:
        schema_content = schema_path.read_text(encoding="utf-8")
        schema = json.loads(schema_content)
    except JSONDecodeError as e:
        raise JSONDecodeError(
            msg=f"Esquema invÃ¡lido en {nombre_esquema}: {e.msg}",
            doc=e.doc,
            pos=e.pos
        ) from e

    # Validar contra Draft 7
    try:
        Draft7Validator(schema=schema, format_checker=Draft7Validator.FORMAT_CHECKER).validate(data)
    except ValidationError as e:
        e.message = f"Error de validaciÃ³n en '{nombre_esquema}': {e.message}"
        raise

**Mejoras respecto a la versiÃ³n anterior:**

1. âœ…Â **Manejo moderno de rutas conÂ `pathlib`:**
    
    python
    
    Copy
    
    Download
    
    base_path = Path(__file__).parent.parent
    schemas_dir = base_path / "schemas"
    
2. âœ…Â **ValidaciÃ³n estricta con Draft 7:**
    
    python
    
    Copy
    
    Download
    
    Draft7Validator(schema=schema, format_checker=Draft7Validator.FORMAT_CHECKER).validate(data)
    
3. âœ…Â **Mensajes de error detallados:**
    
    - Ruta completa en FileNotFoundError
        
    - Contexto del esquema en JSONDecodeError
        
    - Prefijo descriptivo en ValidationError
        
4. âœ…Â **CodificaciÃ³n explÃ­cita UTF-8:**
    
    python
    
    Copy
    
    Download
    
    schema_content = schema_path.read_text(encoding="utf-8")
    
5. âœ…Â **PreservaciÃ³n del stack trace original:**
    
    - Uso deÂ `raise ... from e`Â para mantener contexto de errores
        

**Ejemplo de uso con manejo de errores:**

python

Copy

Download

try:
    validar_esquema(memoria, "schema_base.json")
except FileNotFoundError as e:
    print(f"Error crÃ­tico: {str(e)}")
except JSONDecodeError as e:
    print(f"Esquema corrupto: {str(e)}")
except ValidationError as e:
    print(f"Datos invÃ¡lidos: {str(e)}")

**Estructura de directorios requerida:**

Copy

Download

.
â”œâ”€â”€ core/
â”‚   â””â”€â”€ validador.py
â””â”€â”€ schemas/
    â”œâ”€â”€ schema_base.json
    â””â”€â”€ otros_esquemas/

Esta implementaciÃ³n es:

- ğŸ” 100% compatible con FastAPI
    
- ğŸ Optimizada para Python 3.12
    
- ğŸ“¦ Lista para integraciÃ³n enÂ `memoria_saver.py`
    
- ğŸ›¡ï¸ Robusta en manejo de errores
    
- ğŸ“ Independiente del sistema operativo