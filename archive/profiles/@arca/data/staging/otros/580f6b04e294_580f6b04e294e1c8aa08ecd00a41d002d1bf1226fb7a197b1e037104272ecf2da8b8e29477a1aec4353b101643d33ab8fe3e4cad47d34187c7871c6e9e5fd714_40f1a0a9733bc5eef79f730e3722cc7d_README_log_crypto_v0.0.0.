# ğŸ” MÃ³dulo: log_crypto.py

MÃ³dulo de cifrado y descifrado de archivos de log dentro del sistema `ALMA_RESIST`. Soporta algoritmos modernos como AES-256-GCM y ChaCha20 para garantizar confidencialidad e integridad de los logs almacenados o transmitidos.

---

## ğŸ“š Funcionalidad

### Clases

#### `CryptoEngine`

Clase principal encargada de la lÃ³gica criptogrÃ¡fica.

##### Atributos:

- `algorithm`: Algoritmo criptogrÃ¡fico a utilizar (`AES-256-GCM` o `ChaCha20`)
- `key_length`: Longitud en bytes de la clave derivada (por defecto: 32)

##### MÃ©todos:

- `generar_clave(password: Optional[str] = None) -> Tuple[bytes, bytes]`  
  Genera clave y salt. Si se proporciona un `password`, deriva clave usando PBKDF2HMAC.

- `encrypt_log(input_path: str, output_path: str, key: bytes, salt: bytes)`  
  Cifra un archivo log usando el algoritmo especificado.

- `decrypt_log(input_path: str, output_path: str, key: bytes, salt: bytes)`  
  Descifra un archivo previamente cifrado.

- `validate_encrypted_log(path: str) -> bool`  
  Verifica si el archivo tiene cabecera vÃ¡lida para descifrado.

---

## ğŸ” Algoritmos soportados

| Nombre         | MÃ³dulo usado  | Longitud clave | Requiere salt | Seguridad recomendada |
|----------------|----------------|----------------|----------------|------------------------|
| AES-256-GCM    | `cryptography.hazmat.primitives.ciphers.aead.AESGCM` | 32 bytes      | SÃ­            | Alta                   |
| ChaCha20-Poly1305 | `cryptography.hazmat.primitives.ciphers.aead.ChaCha20Poly1305` | 32 bytes | SÃ­            | Muy alta (stream-safe) |

---

## âœ… Ejemplo de uso

```python
engine = CryptoEngine("AES-256-GCM")
key, salt = engine.generar_clave("mi_password_segura")

# Cifrado
engine.encrypt_log("app.log", "app.log.enc", key, salt)

# Descifrado
engine.decrypt_log("app.log.enc", "app_decrypted.log", key, salt)
```

---

## ğŸ§ª Testing

El mÃ³dulo estÃ¡ cubierto con pruebas automÃ¡ticas `pytest`. UbicaciÃ³n:  
`tests/test_log_crypto.py`

Cobertura:
- Cifrado / Descifrado completo
- ValidaciÃ³n de logs cifrados
- Manejo de errores
- Cambio de claves
- Integridad de datos
- Compatibilidad de algoritmos

---

## ğŸ“ Dependencias

- `cryptography`
- `pytest` (solo para testeo)
- `typing`, `os`, `secrets`, `base64`, `hashlib`, `logging`

---

## ğŸ§  Notas

- Todos los archivos cifrados tienen una cabecera estÃ¡ndar con identificador del algoritmo (`b'ALG:' + nombre_algoritmo.encode()`).
- Salt se requiere para derivar la clave si se usa password.
- Las excepciones estÃ¡n gestionadas con logs para trazabilidad.

---

Â© ALMA_RESIST Â· v0.0.0.4
