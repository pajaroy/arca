#!/bin/bash

# ALMA_RESIST – Script de auditoría automatizada Sprint 2.5
# Ejecuta: entorno, instalación, normalización y validación

echo "🚀 Iniciando entorno ALMA_RESIST..."

# 1. Activar entorno virtual
echo "🔧 Activando entorno virtual..."
source .venv/bin/activate

# 2. Instalar dependencias necesarias
echo "📦 Instalando dependencias requeridas..."
pip install -q pyyaml

# 3. Ejecutar force_snake_case_modules.py
echo "🐍 Normalizando campo 'module' a snake_case..."
python3 docs/utilidades/scripts/force_snake_case_modules.py --verbose

# 4. Ejecutar fix_metadata.py
echo "🛠️ Corrigiendo metadatos YAML..."
python3 docs/utilidades/scripts/fix_metadata.py --verbose --backup

# 5. Ejecutar add_linked_to_minimo.py
echo "🔗 Agregando 'linked_to' mínimo a documentos tipo 'core'..."
python3 docs/utilidades/scripts/add_linked_to_minimo.py --verbose

# 6. Ejecutar validate_docs.py
echo "✅ Validando estructura de metadatos YAML..."
python3 docs/utilidades/scripts/validate_docs.py --verbose

echo "🎉 Auditoría automática finalizada."
