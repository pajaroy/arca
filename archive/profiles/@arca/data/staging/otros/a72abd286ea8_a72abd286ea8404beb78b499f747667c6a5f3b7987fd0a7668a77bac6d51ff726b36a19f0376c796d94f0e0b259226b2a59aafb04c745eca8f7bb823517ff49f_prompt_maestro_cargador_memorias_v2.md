# üß† Prompt Maestro v2 ‚Äî Cargador Universal de Memorias Institucionales (ALMA_RESIST)

**Fecha:** 2025-06-07  
**Version:** v2  
**Responsables:** Santi (humano), Kael (auditor CLI)  
**M√≥dulo:** /home/bird/alma_resist/control_central/memorias/  
**Estado:** Vigente

---

## üéØ Resumen

Desarrollar un **script CLI avanzado** para carga, gesti√≥n y gobernanza de memorias y bit√°coras institucionales (`memorias.json/yaml`, `bitacora_viva.json/yaml`) bajo la arquitectura ALMA_RESIST, con enfoque en eficiencia, seguridad, versionado y automatizaci√≥n IA.

---

## ‚öôÔ∏è Requerimientos funcionales y t√©cnicos

### 1. Gesti√≥n de esquema din√°mica
- Externalizar schema oficial a `/schemas/memoria_schema.json`, versionado sem√°nticamente.
- Validaci√≥n estricta con `jsonschema.Draft7Validator.check_schema()`.
- CLI debe permitir especificar versi√≥n de schema (`--schema-version`).
- Subcomando para validar el schema (`validate-schema`).

### 2. Concurrencia y robustez
- Locks por archivo usando `FileLock` (timeout configurable, default 10s).
- Lockfiles espec√≠ficos por tipo (`*.memoria.lock`, `*.bitacora.lock`).
- Reintentos inteligentes (backoff exponencial) en colisiones.
- Escritura at√≥mica (temp file + swap).

### 3. Integridad y hashing
- Generaci√≥n autom√°tica de SHA-256 para cada registro (`_checksum`).
- Verificaci√≥n previa y reparaci√≥n de hashes (`repair-checksums`).
- Validaci√≥n de integridad en cada lectura/escritura.

### 4. Seguridad y multiidioma
- Soporte multiidioma mediante `gettext` (diccionarios en `/locales/`).
- Flags para forzar idioma (`--lang es/en`), autodetecci√≥n del sistema.
- Validaci√≥n de fechas ISO 8601 y manejo de unicode seguro.
- Roadmap para cifrado AES-GCM y auditor√≠a SELinux.

### 5. Optimizaci√≥n y escalabilidad
- Carga y validaci√≥n optimizadas para miles de registros.
- Conversi√≥n masiva con subcomando `convert` (YAML‚ÜîJSON), soporte recursivo de directorios.
- Soporte de Redis como backend opcional (roadmap).
- API GraphQL planificada para integraci√≥n futura.

### 6. CLI y usabilidad avanzada
- Nuevos flags: `--lock-timeout`, `--no-hash`, `--schema-version`, `--lang`.
- Subcomandos: `validate-schema`, `repair-checksums`.
- Normalizaci√≥n autom√°tica de tags (min√∫sculas, sin duplicados).
- Reporte CLI de memorias cargadas, duplicadas, inconsistentes.

### 7. Logs y auditor√≠a estructurada
- Logs en JSON/YAML, con timestamp, canal/origen, usuario/IA responsable.
- Logs de acciones cr√≠ticas y backups autom√°ticos.
- Registro de todas las inserciones y modificaciones.

### 8. Dependencias y ambiente
- python >= 3.10
- jsonschema >= 5.4.0
- pyyaml >= 7.0
- filelock >= 5.0.0
- rfc3339-validator (nuevo)

---

## üöÄ Roadmap Propuesto

- **Seguridad avanzada:**  
  - Cifrado AES-GCM (desde 2025-06-10)
  - Auditor√≠a SELinux (desde 2025-06-20)
- **Escalabilidad:**  
  - Soporte Redis (desde 2025-06-15)
  - API GraphQL (desde 2025-07-01)

---

## üìÅ Rutas relevantes

- `/home/bird/alma_resist/control_central/memorias/memorias.json`
- `/home/bird/alma_resist/control_central/memorias/bitacora_viva.json`
- `/home/bird/alma_resist/control_central/memorias/memorias.yaml`
- `/home/bird/alma_resist/control_central/memorias/bitacora_viva.yaml`
- `/home/bird/alma_resist/control_central/memorias/schemas/memoria_schema.json`
- `/home/bird/alma_resist/control_central/memorias/locales/` *(diccionarios multiidioma)*

---

## üí° Changelog v1.1.0 (2025-06-07)

- Gesti√≥n de schema din√°mica y versionado externo.
- FileLock y robustez para concurrencia.
- Sistema de hash SHA-256 en cada registro.
- Soporte multiidioma completo.
- Subcomando `convert` y validaciones optimizadas.
- Mejoras de rendimiento (validaci√≥n y carga 2-3x m√°s r√°pida).
- Normalizaci√≥n de tags y mejoras en unicode/ISO.
- Flags CLI avanzados.

---

*‚ÄúLa memoria institucional no es un archivo, es un sistema circulatorio de conocimiento vivo.‚Äù*  
‚Äî Kael, Auditor CLI

---
