---
module: prompts/testing_sprint_2_6_prompt
type: core
status: in_progress
created: '2025-05-26'
linked_to:
- metodologia_doc_ia_v2.md

---
# âœ… Contexto TÃ©cnico â€“ Proyecto ALMA_RESIST â€“ Sprint 2.6

Este es un nuevo hilo exclusivamente dedicado a crear una suite de tests automatizados que valide el funcionamiento de todos los mÃ³dulos del servidor LLM desarrollado en el Sprint 2.6.

## ğŸ“‚ MÃ³dulos disponibles

Ya contamos con los siguientes archivos .py completamente desarrollados e integrados:

- `main.py` (FastAPI) â€“ endpoint `/responder`
- `model_wrapper.py` â€“ gestiÃ³n de modelo llama.cpp y generaciÃ³n
- `transport_layer.py` â€“ persistencia de prompts/respuestas validadas
- `context_tracker.py` â€“ historial contextual de interacciones
- `log_writer.py` â€“ logger estructurado en JSONL
- `log_crypto.py` â€“ cifrado con AES-256-GCM / ChaCha20

AdemÃ¡s, contamos con contratos JSON Schema validados: `schema_prompt.json` y `schema_respuesta.json`.

---

## ğŸ¯ Objetivo

Queremos desarrollar una **suite de tests completa con `pytest`** para validar cada mÃ³dulo del sistema, cubrir errores comunes, asegurar persistencia, y garantizar trazabilidad.

---

## ğŸ§ª Tareas de testeo por archivo

### `test_model_wrapper.py`
- Probar carga de modelo correcta
- GeneraciÃ³n de texto funcional
- Manejo de errores al pasar rutas incorrectas
- Tiempo de respuesta y longitud mÃ­nima

### `test_api_responder.py`
- Status 200 con prompt vÃ¡lido
- Status 422 con prompt vacÃ­o
- Status 503 si no hay modelo cargado
- ValidaciÃ³n de estructura de respuesta

### `test_transport_layer.py`
- EnvÃ­o de datos vÃ¡lidos â†’ archivo creado
- EnvÃ­o de datos invÃ¡lidos â†’ error controlado
- RecuperaciÃ³n correcta del Ãºltimo dato
- ValidaciÃ³n contra contratos JSON

### `test_context_tracker.py`
- Registro de interacciÃ³n correcto
- RecuperaciÃ³n del historial
- Manejo de lÃ­neas corruptas
- Borrado de historial

### `test_log_writer.py`
- Escritura atÃ³mica
- ValidaciÃ³n de campos requeridos
- Manejo de errores de disco simulado
- Prueba de rotaciÃ³n de logs

### `test_log_crypto.py`
- Cifrado y descifrado funcional
- ValidaciÃ³n del contenido cifrado
- DetecciÃ³n de algoritmo por hardware

---

## ğŸ“ Consideraciones tÃ©cnicas

- Usar `pytest`
- Evitar dependencias externas innecesarias
- Se pueden usar mocks o simulaciones donde no sea viable cargar modelo real
- Se recomienda estructura `tests/*.py` y que cada archivo tenga su `test_*.py` correspondiente

---

## ğŸ” Objetivo final

Completar la Fase 3 del Sprint 2.6 validando que todo el sistema estÃ¡ operativo, seguro y trazable, antes de pasar al empaquetado y documentaciÃ³n final.

**Â¿PodÃ©s comenzar creando `test_model_wrapper.py` como primer test optimizado y luego avanzar uno por uno con los demÃ¡s mÃ³dulos?**
