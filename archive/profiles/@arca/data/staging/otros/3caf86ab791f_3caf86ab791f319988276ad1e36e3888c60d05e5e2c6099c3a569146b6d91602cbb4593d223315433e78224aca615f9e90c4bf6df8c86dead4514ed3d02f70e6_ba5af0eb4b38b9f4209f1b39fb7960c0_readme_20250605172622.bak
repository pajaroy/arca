# ğŸ§ª ContextTracker â€“ Suite de Tests

Este directorio contiene las pruebas automatizadas para el mÃ³dulo `ContextTracker`, encargado de registrar interacciones en el sistema ALMA.

---

## ğŸ“‚ Estructura

```
tests/context_tracker/
â”œâ”€â”€ test_context_tracker.py              # VersiÃ³n oficial y activa de pruebas
â”œâ”€â”€ _legacy/                             # Pruebas histÃ³ricas de versiones anteriores
â”‚   â”œâ”€â”€ test_context_tracker_v0.0.0.1.py
â”‚   â”œâ”€â”€ test_context_tracker_v0.0.0.2.py
â”‚   â”œâ”€â”€ test_context_tracker_v0.0.0.3.py
```

---

## âœ… Tests incluidos en `test_context_tracker.py`

| Test                                       | Objetivo |
|-------------------------------------------|----------|
| `test_track_valid_interaction`            | Verifica que se registra correctamente una interacciÃ³n vÃ¡lida |
| `test_invalid_interaction`                | Valida que una interacciÃ³n invÃ¡lida no se registre y se loguee el error |
| `test_get_history_ordering`               | Asegura que los registros se devuelvan en orden correcto (mÃ¡s reciente primero) |
| `test_corrupted_file_handling`            | Manejo de lÃ­neas corruptas dentro del archivo sin romper la ejecuciÃ³n |
| `test_clear_history`                      | Prueba el borrado completo del historial y recreaciÃ³n del archivo |
| `test_history_length`                     | Verifica la longitud del historial ignorando datos corruptos |
| `test_file_permissions`                   | Comprueba que los permisos del archivo sean 0600 para seguridad |
| `test_persistence_across_instances`       | Asegura persistencia del historial entre instancias distintas de ContextTracker |
| `test_cache_limit`                        | Valida que el cachÃ© interno se limite a los Ãºltimos 100 registros |

---

## ğŸ§¼ Buenas prÃ¡cticas

- No modificar `test_context_tracker.py` directamente si se trata de una nueva versiÃ³n.  
  Crear una copia en `_legacy/` y versionar como `test_context_tracker_vX.X.X.X.py`.

- Usar `PYTHONPATH=.` al correr los tests para asegurar los imports relativos correctos:

```bash
PYTHONPATH=. pytest tests/context_tracker/test_context_tracker.py -v
```

- Si un test falla, revisar primero el orden del historial en `ContextTracker.get_history()`.

---

## ğŸ—ƒï¸ HistÃ³rico

| VersiÃ³n | Estado | Notas |
|---------|--------|-------|
| v0.0.0.1 | âŒ Obsoleto | Incompleto y sin fixtures |
| v0.0.0.2 | âŒ Obsoleto | Fallaba con archivos corruptos |
| v0.0.0.3 | âš ï¸ Parcial | Estructura base pero sin validaciones completas |
| v0.0.0.4 | âœ… Estable | VersiÃ³n estable usada como base |
| `test_context_tracker.py` | ğŸŸ¢ Oficial | VersiÃ³n actual, cubre todas las pruebas importantes |

---

## ğŸ” Seguridad

Los tests aseguran que los datos sensibles se escriban con permisos estrictos.  
Ideal para sistemas donde la privacidad de logs es crÃ­tica.

