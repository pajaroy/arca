# 🧪 ContextTracker – Suite de Tests

Este directorio contiene las pruebas automatizadas para el módulo `ContextTracker`, encargado de registrar interacciones en el sistema ALMA.

---

## 📂 Estructura

```
tests/context_tracker/
├── test_context_tracker.py              # Versión oficial y activa de pruebas
├── _legacy/                             # Pruebas históricas de versiones anteriores
│   ├── test_context_tracker_v0.0.0.1.py
│   ├── test_context_tracker_v0.0.0.2.py
│   ├── test_context_tracker_v0.0.0.3.py
```

---

## ✅ Tests incluidos en `test_context_tracker.py`

| Test                                       | Objetivo |
|-------------------------------------------|----------|
| `test_track_valid_interaction`            | Verifica que se registra correctamente una interacción válida |
| `test_invalid_interaction`                | Valida que una interacción inválida no se registre y se loguee el error |
| `test_get_history_ordering`               | Asegura que los registros se devuelvan en orden correcto (más reciente primero) |
| `test_corrupted_file_handling`            | Manejo de líneas corruptas dentro del archivo sin romper la ejecución |
| `test_clear_history`                      | Prueba el borrado completo del historial y recreación del archivo |
| `test_history_length`                     | Verifica la longitud del historial ignorando datos corruptos |
| `test_file_permissions`                   | Comprueba que los permisos del archivo sean 0600 para seguridad |
| `test_persistence_across_instances`       | Asegura persistencia del historial entre instancias distintas de ContextTracker |
| `test_cache_limit`                        | Valida que el caché interno se limite a los últimos 100 registros |

---

## 🧼 Buenas prácticas

- No modificar `test_context_tracker.py` directamente si se trata de una nueva versión.  
  Crear una copia en `_legacy/` y versionar como `test_context_tracker_vX.X.X.X.py`.

- Usar `PYTHONPATH=.` al correr los tests para asegurar los imports relativos correctos:

```bash
PYTHONPATH=. pytest tests/context_tracker/test_context_tracker.py -v
```

- Si un test falla, revisar primero el orden del historial en `ContextTracker.get_history()`.

---

## 🗃️ Histórico

| Versión | Estado | Notas |
|---------|--------|-------|
| v0.0.0.1 | ❌ Obsoleto | Incompleto y sin fixtures |
| v0.0.0.2 | ❌ Obsoleto | Fallaba con archivos corruptos |
| v0.0.0.3 | ⚠️ Parcial | Estructura base pero sin validaciones completas |
| v0.0.0.4 | ✅ Estable | Versión estable usada como base |
| `test_context_tracker.py` | 🟢 Oficial | Versión actual, cubre todas las pruebas importantes |

---

## 🔐 Seguridad

Los tests aseguran que los datos sensibles se escriban con permisos estrictos.  
Ideal para sistemas donde la privacidad de logs es crítica.

