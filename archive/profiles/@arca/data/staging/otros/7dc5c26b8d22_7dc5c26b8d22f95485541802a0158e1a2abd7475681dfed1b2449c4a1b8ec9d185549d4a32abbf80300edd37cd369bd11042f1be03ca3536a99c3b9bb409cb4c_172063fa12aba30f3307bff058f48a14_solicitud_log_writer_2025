---
module: prompts/solicitud_log_writer
type: core
status: in_progress
created: '2025-05-19'
linked_to:
- metodologia_doc_ia_v2.md

---
# ğŸ§  Prompt TÃ©cnico â€“ `log_writer.py` v1.0 â€“ ALMA_RESIST

Este mÃ³dulo forma parte de `Sprint 1` del roadmap tÃ©cnico de ALMA_RESIST.
Su propÃ³sito es implementar un sistema de logging antifrÃ¡gil, seguro, y compatible con sistemas offline y de bajos recursos.

---

## âš™ï¸ Requisitos Generales

- Debe funcionar 100% **offline**, sin dependencias externas.
- Compatible con sistemas **Debian 12+**, CPU de 1 nÃºcleo y 2GB de RAM.
- El log debe escribirse en formato **JSONL**, con una entrada por lÃ­nea.
- Toda escritura debe ser **atÃ³mica y segura ante fallos**.
- El sistema debe **detectar errores no crÃ­ticos** y recuperarse.

---

## ğŸ“„ Detalles Funcionales

### 1. `log_event(event_type, message, module="core")`
- Valida los parÃ¡metros:
  - `event_type` debe ser `INFO`, `WARNING`, o `ERROR`
  - Si es invÃ¡lido, debe **forzarse a "ERROR"** y emitir un `warnings.warn()`
  - Lanza `TypeError` si se pasan tipos incorrectos

- Agrega metadatos automÃ¡ticos:
  - `timestamp` en formato ISO UTC
  - `pid`, `host`, `platform`, `module`
  

### 2. `write_log(event: dict)`
- Escribe el evento en el archivo diario `logs/alma_<fecha>.log`
- Usa **escritura atÃ³mica**:
  - Crea archivo `.tmp`, escribe, y luego renombra con `os.replace()`
- Crea el directorio `logs/` si no existe, con permisos `0700`
- Maneja errores:
  - `JSONEncodeError`, `PermissionError` â†’ Warning + return False
  - `OSError: errno 28` (sin espacio) â†’ Lanza `SystemError`

---

## âœ… Criterios de calidad

- Compatible con caracteres internacionales (`ensure_ascii=False`)
- No debe depender de librerÃ­as externas (solo `os`, `json`, `warnings`, `datetime`, `socket`)
- CÃ³digo modular, con docstrings tipo `>>> doctest`
- Defensivo: cualquier error previsible debe estar manejado

---

## ğŸ§ª Ejemplo de uso:

```python
from core.log_writer import log_event, write_log

entry = log_event("WARNING", "Umbral de CPU excedido", "monitor")
write_log(entry)
```

---

## ğŸ“‚ Estructura de archivos relacionada
- `core/log_writer.py` â†’ mÃ³dulo fuente
- `tests/test_log_writer.py` â†’ test funcional (pasa âœ…)
- `logs/` â†’ carpeta generada automÃ¡ticamente
- `prompts/prompt_log_writer_v1.0.md` â†’ este archivo

---

## ğŸ§± Dependencias del sistema operativo

- Python 3.10+
- Soporte POSIX (`os.replace`, `os.makedirs`, permisos octales)
- No se requiere sistema grÃ¡fico ni librerÃ­as adicionales

---

## ğŸ“Œ Contexto ALMA_RESIST
Este mÃ³dulo es el primer componente estable del `Sprint 1 â€“ Logging cifrado antifrÃ¡gil`. Fue validado manualmente y serÃ¡ base de auditorÃ­a para los mÃ³dulos `log_crypto.py` y `log_integrity.py`.
