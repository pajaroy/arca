# üß† Prompt DeepSeek ‚Äì Script Universal de Correcci√≥n y Estandarizaci√≥n de Metadata (fix_metadata v2) para ALMA_RESIST

---

## **Contexto:**
Desarrollar un script profesional, seguro y auditable para el ecosistema ALMA_RESIST, alojado por convenci√≥n en cada m√≥dulo en:  
`core/scripts/fix_metadata/`

El objetivo es validar, corregir y estandarizar los bloques de metadata YAML en todos los archivos cr√≠ticos de cada m√≥dulo, dejando logs y backups de cada cambio y asegurando que NO se toquen archivos ni carpetas excluidas o sensibles.

---

## **Requisitos funcionales y de seguridad**

### 1. **Recorrido y exclusi√≥n**
- El script debe buscar la ra√≠z del m√≥dulo (por arriba) y procesar TODOS los archivos relevantes (.md, .yaml, .json, .py, .sh), pero:
- **Nunca debe modificar ni recorrer** (incluir lista de exclusi√≥n obligada):
    - `.git`, `.github`, `.obsidian`, `.sync*`, `venv`, `env`, `virtualenv`, `__pycache__`, `node_modules`, `datasets`, `data`, `media`, `images`, `img`, `bin`, `backup`, `backups`, `logs` (salvo logs propios `.md`, `.yaml`), `tmp`, `temp`, `core/scripts/fix_metadata/` (para no auto-editarse), cualquier directorio oculto (`.`), o especificado en `.fix_metadata_ignore`.
- **No modificar archivos binarios ni temporales**: (extensiones excluidas: `.jpg`, `.png`, `.zip`, `.db`, `.mp4`, `.exe`, `.tmp`, `.bak`, `.lock`, `.sync-conflict-*`).
- Solo procesar extensiones soportadas: `.md`, `.yaml`, `.yml`, `.json`, `.py`, `.sh`.

### 2. **Exclusi√≥n ampliable**
- Permitir que el usuario agregue exclusiones espec√≠ficas con un archivo `.fix_metadata_ignore` (sintaxis tipo `.gitignore`).

### 3. **Flujo seguro**
- **Nunca debe auto-modificarse** ni modificar el propio script/carpeta.
- Debe siempre crear **backup previo** a modificar cualquier archivo.
- **Modo dry-run**: simular cambios sin modificar archivos.
- **Logs estructurados** por acci√≥n: cambios, errores, archivos saltados, backups.
- **No debe borrar ni truncar archivos aunque detecte metadata inv√°lida**: siempre loguear, nunca borrar.

### 4. **Metadata universal a aplicar**
El bloque YAML debe tener, como m√≠nimo, los siguientes campos (con comentarios y validaciones):

```yaml
---
version: 1.0
id: <tipo>_<yyyy-mm-dd>_<xx>           # Ejemplo: MEM_2025-06-06_04
tipo: <tipo_registro>                  # fundacional, decision, bitacora, changelog, script, etc.
formato: <md|yaml|py|sh|json>
modulo: <modulo/carpeta>
titulo: "<t√≠tulo_breve_descriptivo>"
autor: <humano|agente>
fecha_creacion: YYYY-MM-DD
fecha_actualizacion: YYYY-MM-DD
status: <activo|cerrado|en_revision|obsoleto>
version_sistema: <sistema_version>
origen: <archivo_origen|manual>
tags: [tag1, tag2, ...]
hash_integridad: sha256:<hash>
linked_to: [relaciones_cruzadas]
descripcion: >
  Breve descripci√≥n del prop√≥sito y contexto del archivo.
---
```
5. Caracter√≠sticas del script

    Recorrer en profundidad solo las carpetas relevantes (ver exclusiones arriba).

    Verificar y corregir el bloque YAML, completando campos faltantes (con valores razonables por defecto/documentados).

    Calcular y actualizar hash_integridad SHA256 del contenido excluyendo este campo.

    Logs de cambios, backups realizados, errores detectados.

    Reporte resumen al finalizar.

    F√°cilmente replicable: al copiar a cualquier m√≥dulo, funciona sin cambios salvo rutas.

    Par√°metro de carpeta ra√≠z opcional, autodetecci√≥n de entorno ALMA_RESIST.

    Dejar configuraciones claras y comentarios para personalizaci√≥n.

    Modular, con funciones separadas y comentarios abundantes.

6. Pr√°cticas pro

    El script nunca debe dejar archivos corruptos ni en estado incompleto (rollback autom√°tico si hay error en escritura).

    Soporte para ampliar lista de exclusi√≥n por par√°metro CLI.

    El log puede ser en .jsonl o .yaml para facilitar parsing IA/auditor√≠a.

    Resumen final: archivos procesados, modificados, saltados, errores, backups hechos, dry-run vs real.

Extras

    Programar en Python 3, preferentemente solo usando dependencias est√°ndar (salvo PyYAML).

    Dejar toda la l√≥gica en un solo archivo principal.

    Dejar la referencia a este prompt/IDEA en el header del script generado.

    El script debe estar listo para ejecutarse desde cualquier carpeta core/scripts/fix_metadata/.

Referencia oficial:
[IDEA_2025-06-06_01] ‚Äì ALMA_RESIST | Santiago Calvo | Centralesis v2.3
Instrucciones finales

    Cumpl√≠ TODOS los criterios arriba detallados.

    Si no pod√©s hacer algo exactamente igual, aclaralo en comentarios y dej√° el punto listo para ajustar manualmente.

    El script debe ser ‚Äúproduction ready‚Äù para ser usado y adaptado en cualquier otro m√≥dulo del sistema ALMA_RESIST.
    ---

## üü¢ **Archivo descargable**

[Descargar prompt_fix_metadata_v2.md](sandbox:/mnt/data/prompt_fix_metadata_v2.md)

> **Pod√©s copiar el contenido directamente o usar el archivo para cargarlo en DeepSeek o cualquier plataforma de generaci√≥n IA!**

¬øTe gustar√≠a agregar alguna advertencia, nota personal, o link de referencia extra?  
¬øO lo dejamos as√≠, listo para darle play en DeepSeek?

---

## üü¢ Ap√©ndice: Notificaciones claras de estado al usuario

**Requisito adicional para el script:**

- Al finalizar el proceso (sea en modo real o dry-run), el script debe mostrar **notificaciones claras** por consola indicando:
  - ‚úîÔ∏è **√âxito**: Si todo termin√≥ bien, muestra un mensaje tipo ‚Äú‚úÖ Proceso completado correctamente. Todos los archivos procesados sin errores.‚Äù
  - ‚ö†Ô∏è **Advertencias**: Si hubo archivos saltados, errores menores o archivos no modificados, mostrar resumen con conteo y detalles.
  - ‚ùå **Errores**: Si el script encuentra errores cr√≠ticos (no puede modificar, acceso denegado, excepci√≥n grave), mostrar el error en rojo/visible y sugerir revisi√≥n del log.

**Recomendaciones de formato:**
- Usar emojis o color terminal (`print('\033[92m ... \033[0m'` para verde, `\033[91m` para rojo, etc.) para destacar estados.
- El resumen final debe incluir:  
  - Archivos procesados, modificados, saltados, errores, backups realizados.
  - Ruta del log generado y sugerencia de revisar logs si hay advertencias o errores.

**Ejemplo de notificaci√≥n final esperada:**

```bash
‚úÖ Proceso completado correctamente. Archivos procesados: 38 | Modificados: 11 | Errores: 0 | Ver detalles en fix_metadata.log
```
o, en caso de error:

```bash
‚ùå Proceso finalizado con errores. Archivos procesados: 38 | Modificados: 10 | Errores: 2
Revis√° el log 'fix_metadata.log' para ver los detalles de los errores.
```

o, si solo hubo advertencias:

```bash
‚ö†Ô∏è Proceso finalizado con advertencias. Algunos archivos no pudieron procesarse autom√°ticamente.
Revis√° el log para detalles: archivos saltados, advertencias, errores menores.
```



Esto mejora la experiencia y reduce el riesgo de omitir problemas tras la ejecuci√≥n.

---

Con esto, el script generado ser√° mucho m√°s ‚Äúhumano-friendly‚Äù y auditable,  
y DeepSeek sabr√° que debe priorizar la comunicaci√≥n clara del estado final del proceso.